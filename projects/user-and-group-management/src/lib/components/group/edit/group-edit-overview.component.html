<mat-expansion-panel [expanded]="!(editMode$ | async)">
  <mat-expansion-panel-header>
    <mat-panel-title>
      <span *ngIf="(editMode$ | async) else newGroupTitle">Edit Group</span>
      <ng-template #newGroupTitle>Create Group</ng-template>
    </mat-panel-title>
    <mat-panel-description>
      <span>{{ (group$ | async)?.name }}</span>
      <span class="spacer"></span>
      <mat-icon>edit</mat-icon>
    </mat-panel-description>
  </mat-expansion-panel-header>

  <kypo-controls [controls]="controls" (itemClicked)="onControlAction($event)"></kypo-controls>
  <mat-divider></mat-divider>
  <kypo2-group-edit
    (edited)="onGroupChanged($event)"
    [group]="group$ | async">
  </kypo2-group-edit>
</mat-expansion-panel>

<mat-expansion-panel [disabled]="!(editMode$ | async)" [expanded]="editMode$ | async">
  <mat-expansion-panel-header>
    <mat-panel-title>Edit Members </mat-panel-title>
    <mat-panel-description>
      <div class="panel-description-error" *ngIf="!canDeactivateMembers">
        <mat-icon color="warn">warning</mat-icon>
        <mat-error>Changes in group members are not saved</mat-error>
      </div>
      <span class="spacer"></span>
      <mat-icon>person</mat-icon>
    </mat-panel-description>
  </mat-expansion-panel-header>
  <kypo2-group-user-assign [resource]="group$ | async"
                           (hasUnsavedChanges)="onUnsavedMembersChange($event)">
  </kypo2-group-user-assign>
</mat-expansion-panel>

<mat-expansion-panel [disabled]="!(editMode$ | async)" [expanded]="editMode$ | async">
  <mat-expansion-panel-header>
    <mat-panel-title>Edit Roles</mat-panel-title>
    <mat-panel-description>
      <div class="panel-description-error" *ngIf="!canDeactivateRoles">
        <mat-icon color="warn">warning</mat-icon>
        <mat-error>Changes in group members are not saved</mat-error>
      </div>
      <span class="spacer"></span>
      <mat-icon>policy</mat-icon>
    </mat-panel-description>
  </mat-expansion-panel-header>
  <kypo2-group-role-assign [resource]="group$ | async"
                           (hasUnsavedChanges)="onUnsavedRolesChange($event)">
  </kypo2-group-role-assign>
</mat-expansion-panel>
